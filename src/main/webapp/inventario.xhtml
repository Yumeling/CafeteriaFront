<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:p="http://primefaces.org/ui"
      xmlns:f="http://xmlns.jcp.org/jsf/core">
<h:head>
    <title>Inventario - Cafetería NamNam</title>
    <style>
        :root{ --bg:#f5f7fb; --card:#fff; --muted:#7f8c8d; --small:13px; }
        body{ margin:0; font-family:'Segoe UI', Tahoma, Verdana, sans-serif; background:var(--bg); }
        .container{ padding:1.25rem; }
        .card{ background:var(--card); padding:1rem; border-radius:10px; box-shadow:0 6px 18px rgba(0,0,0,0.06); }
        .header{ display:flex; justify-content:space-between; align-items:center; margin-bottom:1rem; }
        .muted { color:var(--muted); font-size:var(--small); }
        .col-truncate { max-width:260px; overflow:hidden; text-overflow:ellipsis; white-space:nowrap; display:inline-block; }
    </style>
</h:head>
<h:body>
    <h:form id="mainForm">
        <f:event type="preRenderView" listener="#{inventarioBean.cargarInventarios}" />

        <div class="container">
            <div class="card">
                <div class="header">
                    <div>
                        <h2>Inventarios</h2>
                        <small class="muted">Total: <strong>#{inventarioBean.inventarios.size()}</strong></small>
                    </div>
                    <div>
                        <p:messages id="msgs" autoUpdate="true" showDetail="true" showSummary="false" closable="true" />
                        <p:commandButton icon="pi pi-refresh" title="Refrescar"
                                         actionListener="#{inventarioBean.cargarInventarios}" process="@this"
                                         update=":mainForm:dtInventarios :mainForm:msgs" />
                        <!-- botón para reconstruir inventarios automáticamente -->
                        <p:commandButton value="Reconstruir inventarios" icon="pi pi-cog"
                                         actionListener="#{inventarioBean.reconstruirInventarios}"
                                         process="@this"
                                         update=":mainForm:dtInventarios :mainForm:msgs" />
                    </div>
                </div>

                <!-- Tabla: id, cantidad (calculada) y nombre del ingrediente -->
                <p:dataTable id="dtInventarios" value="#{inventarioBean.inventarios}" var="inv"
                             paginator="true" rows="10" responsiveLayout="scroll" emptyMessage="No hay inventarios"
                             style="width:100%">

                    <p:column headerText="ID" style="width:80px; text-align:center;">
                        <h:outputText value="#{inv.inventarioId}" />
                    </p:column>

                    <p:column headerText="Cantidad (total)" style="width:140px; text-align:center;">
                        <h:outputText value="#{inv.cantidad != null ? inv.cantidad : 0}" />
                        <h:outputText value=" (calculada)" styleClass="muted" />
                    </p:column>

                    <p:column headerText="Ingrediente" style="text-align:left;">
                        <h:outputText value="#{inventarioBean.getIngredienteNombreById(inv.ingredienteId)}" styleClass="col-truncate" />
                    </p:column>

                </p:dataTable>
            </div>
        </div>
    </h:form>
</h:body>
</html>
